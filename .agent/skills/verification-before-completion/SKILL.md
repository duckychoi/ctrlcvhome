---
name: verification-before-completion
description: 작업 완료, 수정됨, 통과 주장 전 반드시 사용. 커밋이나 PR 전에 검증 명령어 실행하고 출력 확인 필수. 항상 주장 전 증거.
---

# Verification Before Completion (완료 전 검증)

## 개요

검증 없이 작업 완료를 주장하는 것은 효율이 아니라 불정직이다.

**핵심 원칙:** 항상 주장 전 증거.

**이 규칙의 문자를 위반하는 것은 규칙의 정신을 위반하는 것이다.**

---

## Iron Law (철칙)

```
⛔ 새로운 검증 증거 없이 완료 주장 금지
```

이 메시지에서 검증 명령어를 실행하지 않았다면, 통과한다고 주장할 수 없다.

---

## Gate Function (게이트 함수)

```
어떤 상태를 주장하거나 만족을 표현하기 전:

1. IDENTIFY: 이 주장을 증명하는 명령어는 무엇인가?
2. RUN: 전체 명령어 실행 (fresh, complete)
3. READ: 전체 출력, exit code 확인, 실패 수 카운트
4. VERIFY: 출력이 주장을 확인하는가?
   - NO → 증거와 함께 실제 상태 진술
   - YES → 증거와 함께 주장 진술
5. ONLY THEN: 주장하기

어느 단계든 건너뛰기 = 거짓말, 검증 아님
```

---

## 흔한 실패

| 주장 | 필요한 것 | 충분하지 않은 것 |
|------|----------|----------------|
| 테스트 통과 | 테스트 명령어 출력: 0 실패 | 이전 실행, "통과할 거야" |
| 린터 깨끗 | 린터 출력: 0 에러 | 부분 체크, 추론 |
| 빌드 성공 | 빌드 명령어: exit 0 | 린터 통과, 로그 괜찮아 보임 |
| 버그 수정됨 | 원래 증상 테스트: 통과 | 코드 변경됨, 수정 가정 |
| 리그레션 테스트 작동 | Red-green 사이클 검증됨 | 테스트가 한 번 통과 |
| 에이전트 완료 | VCS diff가 변경 보여줌 | 에이전트가 "성공" 리포트 |
| 요구사항 충족 | 라인별 체크리스트 | 테스트 통과 |

---

## Red Flags - 멈춤

다음에 해당하면 멈춘다:
- "should", "probably", "seems to" 사용
- 검증 전 만족 표현 ("Great!", "Perfect!", "Done!" 등)
- 검증 없이 커밋/푸시/PR 하려 함
- 에이전트 성공 리포트 신뢰
- 부분 검증에 의존
- "이번만" 생각
- 피곤하고 작업 끝내고 싶음
- **검증 실행 없이 성공을 암시하는 어떤 표현**

---

## 합리화 방지

| 변명 | 현실 |
|------|------|
| "이제 작동할 거야" | 검증 실행해 |
| "확신해" | 확신 ≠ 증거 |
| "이번만" | 예외 없음 |
| "린터 통과했어" | 린터 ≠ 컴파일러 |
| "에이전트가 성공이라 했어" | 독립적으로 검증해 |
| "피곤해" | 피로 ≠ 변명 |
| "부분 체크면 충분해" | 부분은 아무것도 증명 안 함 |
| "다른 표현이라 규칙 적용 안 돼" | 문자보다 정신 |

---

## 핵심 패턴

### 테스트

```bash
# ✅ 올바름
npm test
# See: 34/34 pass
"All tests pass"

# ❌ 틀림
"Should pass now" / "Looks correct"
```

### 리그레션 테스트 (TDD Red-Green)

```bash
# ✅ 올바름
1. 테스트 작성 → 실행 (통과)
2. 수정 되돌리기 → 실행 (반드시 실패해야 함)
3. 복원 → 실행 (통과)

# ❌ 틀림
"I've written a regression test" (red-green 검증 없이)
```

### 빌드

```bash
# ✅ 올바름
npm run build
# See: exit 0
"Build passes"

# ❌ 틀림
"Linter passed" (린터는 컴파일 체크 안 함)
```

### 요구사항

```
# ✅ 올바름
1. 플랜 다시 읽기
2. 체크리스트 작성
3. 각 항목 검증
4. 갭 또는 완료 리포트

# ❌ 틀림
"Tests pass, phase complete"
```

### 에이전트 위임

```
# ✅ 올바름
1. 에이전트가 성공 리포트
2. VCS diff 확인
3. 변경 검증
4. 실제 상태 리포트

# ❌ 틀림
에이전트 리포트 신뢰
```

---

## 왜 이게 중요한가

실패 기록에서:
- 사용자가 "믿을 수 없어" 했음 - 신뢰 깨짐
- 정의되지 않은 함수가 배포됨 - 크래시 발생했을 것
- 누락된 요구사항이 배포됨 - 불완전한 기능
- 거짓 완료 → 방향 전환 → 재작업에 시간 낭비
- 위반: "정직은 핵심 가치. 거짓말하면 교체당함."

---

## 언제 적용하는가

**항상 다음 전에:**
- 성공/완료 주장의 어떤 변형
- 만족의 어떤 표현
- 작업 상태에 대한 어떤 긍정적 진술
- 커밋, PR 생성, 태스크 완료
- 다음 태스크로 이동
- 에이전트에 위임

**규칙이 적용되는 대상:**
- 정확한 문구
- 패러프레이즈와 동의어
- 성공의 암시
- 완료/정확성을 시사하는 어떤 커뮤니케이션

---

## 검증 명령어 예시

### JavaScript/TypeScript

```bash
# 테스트
npm test
npm run test:unit
npm run test:e2e

# 빌드
npm run build
npm run typecheck
npx tsc --noEmit

# 린트
npm run lint
npx eslint .
```

### Python

```bash
# 테스트
pytest
pytest -v tests/
python -m pytest --tb=short

# 타입 체크
mypy .
pyright

# 린트
ruff check .
flake8
```

### Go

```bash
# 테스트
go test ./...
go test -v -race ./...

# 빌드
go build ./...

# 린트
golangci-lint run
```

### Rust

```bash
# 테스트
cargo test
cargo test -- --nocapture

# 빌드
cargo build
cargo build --release

# 린트
cargo clippy
```

---

## 검증 체크리스트

완료 주장 전:

- [ ] 검증 명령어를 식별했는가?
- [ ] 이 메시지에서 명령어를 실행했는가?
- [ ] 전체 출력을 읽었는가?
- [ ] Exit code를 확인했는가?
- [ ] 실패/에러 수를 카운트했는가?
- [ ] 출력이 주장을 지지하는가?

하나라도 NO면: 완료 주장 금지

---

## Bottom Line (결론)

**검증에 지름길 없음.**

명령어를 실행한다. 출력을 읽는다. 그 다음에 결과를 주장한다.

이것은 협상 불가다.
