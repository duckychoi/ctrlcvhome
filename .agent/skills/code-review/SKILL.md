---
name: code-review
description: 태스크 완료, 주요 기능 구현, 또는 머지 전에 코드 검토 요청. 2단계 리뷰 시스템 (Spec Compliance → Code Quality).
---

# Code Review (코드 리뷰)

## 개요

이슈가 쌓이기 전에 잡기 위해 코드 리뷰를 수행한다.

**핵심 원칙:** 일찍 리뷰, 자주 리뷰.

---

## 2단계 리뷰 시스템

```
┌────────────────────────────────────────────────────────────────┐
│                    Two-Stage Code Review                        │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Stage 1: Spec Compliance Review (스펙 준수 리뷰)               │
│  ├── 요구사항과 구현이 일치하는가?                               │
│  ├── 누락된 기능이 있는가?                                      │
│  ├── 요청되지 않은 추가 기능이 있는가?                          │
│  └── ❌ 불일치 발견 시 → 수정 요청                              │
│                                                                 │
│  Stage 2: Code Quality Review (코드 품질 리뷰)                  │
│  ├── 코드 품질이 좋은가?                                        │
│  ├── 아키텍처 패턴을 따르는가?                                  │
│  ├── 테스트 커버리지가 충분한가?                                │
│  └── 이슈 심각도 분류: Critical / Important / Minor             │
│                                                                 │
│  ✅ 둘 다 통과해야 완료                                         │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

---

## 언제 리뷰 요청하는가

### 필수

- 각 태스크 완료 후 (subagent-driven development)
- 주요 기능 완료 후
- main 브랜치 머지 전

### 선택 (하지만 가치있음)

- 막혔을 때 (신선한 관점)
- 리팩토링 전 (베이스라인 체크)
- 복잡한 버그 수정 후

---

## Stage 1: Spec Compliance Review

### 목적

구현이 요구사항과 정확히 일치하는지 확인

### 체크리스트

```markdown
## Spec Compliance Checklist

### 요구사항 일치
- [ ] 모든 필수 기능이 구현되었는가?
- [ ] 각 기능이 스펙대로 동작하는가?
- [ ] 예외 처리가 스펙대로 되어 있는가?

### 누락 확인
- [ ] 스펙에 있지만 구현되지 않은 것은?
- [ ] 암묵적 요구사항이 누락되지 않았는가?

### 추가 기능 확인
- [ ] 스펙에 없는 추가 기능이 있는가?
- [ ] Over-engineering 하지 않았는가?
- [ ] YAGNI (You Aren't Gonna Need It) 위반은?

### 결과
- ✅ Spec Compliant: 모든 요구사항 충족, 추가 기능 없음
- ❌ Issues Found: [구체적 이슈 나열]
```

### 불일치 발견 시

```markdown
## Spec Compliance Issues Found

### 누락된 기능
1. [기능명]: 스펙에는 있지만 구현되지 않음
   - 스펙 위치: [파일:라인]
   - 필요한 구현: [설명]

### 추가된 기능 (요청되지 않음)
1. [기능명]: 스펙에 없는 기능이 추가됨
   - 위치: [파일:라인]
   - 조치: 제거 또는 스펙에 추가

### 불일치
1. [항목]: 스펙과 다르게 구현됨
   - 스펙: [예상 동작]
   - 실제: [실제 동작]
```

---

## Stage 2: Code Quality Review

### 목적

코드가 잘 작성되었는지, 유지보수 가능한지 확인

### 이슈 심각도

| 심각도 | 설명 | 조치 |
|--------|------|------|
| **Critical** | 반드시 수정 | 진행 전 즉시 수정 |
| **Important** | 수정 권장 | 진행 전 수정 |
| **Minor** | 개선 제안 | 나중에 수정 가능 |

### 체크리스트

```markdown
## Code Quality Checklist

### 아키텍처 & 설계
- [ ] SOLID 원칙을 따르는가?
- [ ] 적절한 관심사 분리가 되어 있는가?
- [ ] 의존성이 적절히 주입되는가?
- [ ] 기존 패턴과 일관성이 있는가?

### 코드 품질
- [ ] 변수/함수 이름이 명확한가?
- [ ] 매직 넘버/스트링이 상수화되어 있는가?
- [ ] 코드 중복이 없는가 (DRY)?
- [ ] 복잡도가 적절한가?

### 에러 처리
- [ ] 모든 에러 케이스가 처리되는가?
- [ ] 에러 메시지가 도움이 되는가?
- [ ] 적절한 로깅이 있는가?

### 테스트
- [ ] 충분한 테스트 커버리지가 있는가?
- [ ] 엣지 케이스가 테스트되는가?
- [ ] 테스트가 실제 동작을 테스트하는가 (mock 아님)?

### 보안
- [ ] 입력 검증이 되어 있는가?
- [ ] SQL Injection, XSS 등 취약점이 없는가?
- [ ] 민감 정보가 로그되지 않는가?

### 성능
- [ ] N+1 쿼리 문제가 없는가?
- [ ] 불필요한 연산이 없는가?
- [ ] 적절한 캐싱이 적용되는가?
```

### 리뷰 결과 형식

```markdown
## Code Review Report

### 요약
- **Spec Compliance**: ✅ Passed / ❌ Issues Found
- **Code Quality**: ✅ Approved / ⚠️ Needs Work
- **Overall**: Ready to merge / Needs revision

### Strengths (잘한 점)
- [긍정적인 점 1]
- [긍정적인 점 2]

### Issues Found

#### Critical (즉시 수정 필요)
1. [파일:라인] [이슈 설명]
   - 문제: [구체적 문제]
   - 제안: [해결 방법]

#### Important (진행 전 수정)
1. [파일:라인] [이슈 설명]
   - 문제: [구체적 문제]
   - 제안: [해결 방법]

#### Minor (나중에 수정 가능)
1. [파일:라인] [이슈 설명]
   - 제안: [개선 방법]

### 최종 판정
- [ ] ✅ Approved - 머지 가능
- [ ] ⚠️ Approved with comments - 마이너 이슈 있지만 머지 가능
- [ ] ❌ Changes requested - 수정 후 재리뷰 필요
```

---

## 리뷰 요청 방법

### 1. Git SHA 가져오기

```bash
BASE_SHA=$(git rev-parse HEAD~1)  # 또는 origin/main
HEAD_SHA=$(git rev-parse HEAD)
```

### 2. 리뷰 요청 템플릿

```markdown
## Code Review Request

### 컨텍스트
- **구현 내용**: [무엇을 구현했는가]
- **관련 태스크**: [TASKS.md의 태스크 번호]
- **플랜/요구사항**: [참조 문서]

### 변경 범위
- **Base SHA**: [BASE_SHA]
- **Head SHA**: [HEAD_SHA]
- **변경 파일**: [파일 목록]

### 리뷰 요청 사항
1. Spec Compliance 확인
2. Code Quality 확인
3. [특별히 확인 요청하는 사항]

### Diff 명령어
```bash
git diff {BASE_SHA}..{HEAD_SHA}
```
```

---

## 피드백 대응

### Critical 이슈

- 즉시 수정
- 재리뷰 요청

### Important 이슈

- 진행 전 수정
- 수정 후 재리뷰

### Minor 이슈

- 기록해두기
- 나중에 수정 (필요시)

### 리뷰어가 틀렸을 때

- 기술적 근거로 반박
- 작동 증명하는 코드/테스트 보여주기
- 명확화 요청

---

## Red Flags

### 절대 하지 않을 것

- "단순해서" 리뷰 건너뛰기
- Critical 이슈 무시
- 미수정 Important 이슈로 진행
- 유효한 기술적 피드백에 반박

### 리뷰어가 틀렸을 때

- 기술적 근거로 반박
- 작동 증명하는 코드/테스트 보여주기
- 명확화 요청

---

## 워크플로우 통합

### Auto-Orchestrate에서

```
Phase N의 각 태스크:
  1. Implementer가 구현
  2. Stage 1: Spec Compliance Review
     - Pass → Stage 2로
     - Fail → 수정 후 재리뷰
  3. Stage 2: Code Quality Review
     - Approved → 다음 태스크
     - Changes Requested → 수정 후 재리뷰
```

### 수동 개발에서

```
기능 완료:
  1. 자체 점검 (셀프 리뷰)
  2. 리뷰 요청
  3. 피드백 반영
  4. 재리뷰 (필요시)
  5. 머지
```

---

## 셀프 리뷰 체크리스트

코드 리뷰 요청 전 자체 점검:

```markdown
## Self-Review Checklist

### 기본 확인
- [ ] 코드가 컴파일/실행되는가?
- [ ] 모든 테스트가 통과하는가?
- [ ] 린트 에러가 없는가?

### 코드 확인
- [ ] 디버그 코드/console.log가 제거되었는가?
- [ ] 하드코딩된 값이 없는가?
- [ ] 주석이 최신 상태인가?

### 변경 확인
- [ ] 의도한 파일만 변경되었는가?
- [ ] 불필요한 변경이 없는가?
- [ ] 커밋 메시지가 명확한가?

### 문서 확인
- [ ] README 업데이트가 필요한가?
- [ ] API 문서 업데이트가 필요한가?
```

---

## 참조 파일

- `references/review-checklist.md` - 상세 체크리스트
- `references/issue-templates.md` - 이슈 리포트 템플릿
